{% extends "base.html" %}

{% block title %}News Feed - The Daily Light{% endblock %}

{% block content %}
<div class="feed-container">
    <div class="feed-header">
        <h2>The Light Feed</h2>
        <button id="toggle-read-btn" class="btn-toggle-read" onclick="toggleReadArticles()">
            Show Previously Read Articles
        </button>
    </div>

    <div id="articles-container">
        {% if articles %}
            {% for article in articles %}
            <article class="news-card" data-article-id="{{ article.id }}">
                <div class="card-image">
                    {% if article.image_url %}
                        <img src="{{ article.image_url }}" alt="{{ article.title }}"
                             onerror="this.src='/static/images/placeholder.jpg'">
                    {% else %}
                        <div class="placeholder-image">
                            <span>üì∞</span>
                        </div>
                    {% endif %}
                </div>
                <div class="card-content">
                    <!-- Action Bar (Like, Comment, Share) -->
                    <div class="action-bar">
                        <button class="action-btn like-btn"
                                data-article-id="{{ article.id }}"
                                data-liked="false"
                                onclick="toggleLike({{ article.id }})"
                                aria-label="Like">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path class="like-outline" d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/>
                                <path class="like-filled" style="display: none;" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                        </button>
                        <button class="action-btn comment-btn"
                                onclick="toggleComments({{ article.id }})"
                                aria-label="Comment">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
                            </svg>
                        </button>
                        <button class="action-btn share-btn"
                                onclick="shareArticle({{ article.id }})"
                                aria-label="Share">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Like Display (Instagram-style) -->
                    <div class="likes-display" data-article-id="{{ article.id }}">
                        <span class="like-count">0 likes</span>
                    </div>

                    <!-- Article Content -->
                    <h3>{{ article.title }}</h3>
                    <p class="meta">
                        <span class="source">{{ article.source_name }}</span>
                        {% if article.published_at %}
                        <span class="separator">‚Ä¢</span>
                        <span class="date">{{ article.published_at.strftime('%B %d, %Y') }}</span>
                        {% endif %}
                    </p>
                    {% if article.description %}
                        <p class="description">{{ article.description }}</p>
                    {% endif %}
                    <a href="{{ article.source_url }}" target="_blank" class="read-more">
                        Read Full Article ‚Üí
                    </a>

                    <!-- Happiness Meter -->
                    <div class="happiness-meter" data-article-id="{{ article.id }}">
                        <div class="happiness-header">
                            <span class="happiness-label">Happiness Meter</span>
                            <span class="happiness-percentage">0%</span>
                        </div>
                        <div class="happiness-bar-container">
                            <div class="happiness-bar" style="width: 0%;">
                                <div class="happiness-shine"></div>
                            </div>
                            <div class="happiness-emoji">üòä</div>
                        </div>
                        <div class="happiness-info">
                            <span class="happiness-count">Be the first to rate this post!</span>
                        </div>
                        <div class="happiness-slider-container">
                            <input type="range" class="happiness-slider"
                                   min="0" max="100" value="0" step="1"
                                   data-article-id="{{ article.id }}"
                                   oninput="updateHappinessPreview({{ article.id }}, this.value)"
                                   onchange="rateHappiness({{ article.id }}, this.value)">
                            <div class="happiness-slider-labels">
                                <span>üòê Meh</span>
                                <span>üôÇ Okay</span>
                                <span>üòä Good</span>
                                <span>üòÉ Great</span>
                                <span>ü§© Amazing!</span>
                            </div>
                        </div>
                    </div>

                    <!-- Comments Section -->
                    <div class="comments-section" data-article-id="{{ article.id }}" style="display: none;">
                        <div class="comments-header">
                            <h4>Comments <span class="comment-count">0</span></h4>
                        </div>

                        <!-- Comment Input -->
                        <div class="comment-input-container">
                            <textarea class="comment-input"
                                      placeholder="Add a comment..."
                                      maxlength="1000"
                                      rows="2"></textarea>
                            <div class="comment-input-footer">
                                <span class="char-count">0/1000</span>
                                <button class="btn-post-comment" onclick="postComment({{ article.id }})">Post</button>
                            </div>
                        </div>

                        <!-- Comments List -->
                        <div class="comments-list">
                            <!-- Comments will be loaded dynamically -->
                        </div>
                    </div>
                </div>
            </article>
            {% endfor %}
        {% else %}
            <div class="no-articles">
                <h3>No articles available</h3>
                <p>Please check back later or contact the administrator.</p>
            </div>
        {% endif %}
    </div>

    {% if articles|length == 5 %}
    <div class="load-more-container">
        <button id="load-more-btn" class="btn-load-more" onclick="loadMore()">
            Load More Good News
        </button>
    </div>
    {% endif %}
</div>

<!-- Report Comment Modal -->
<div id="report-modal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="closeReportModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Report Comment</h3>
            <button class="modal-close" onclick="closeReportModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p class="modal-description">Please tell us why you're reporting this comment:</p>
            <textarea id="report-reason" placeholder="Describe the issue (optional)" maxlength="500" rows="4"></textarea>
            <span class="char-count"><span id="report-char-count">0</span>/500</span>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeReportModal()">Cancel</button>
            <button class="btn-submit" onclick="submitReport()">Submit Report</button>
        </div>
    </div>
</div>
{% endblock %}
